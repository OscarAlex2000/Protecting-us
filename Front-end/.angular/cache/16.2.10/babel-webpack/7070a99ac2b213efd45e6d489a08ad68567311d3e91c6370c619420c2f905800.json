{"ast":null,"code":"import { Component, ViewChild } from '@angular/core';\nimport * as mapboxgl from 'mapbox-gl';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"../../shared/menu/menu.component\";\nconst _c0 = [\"mapa\"];\nconst _c1 = a0 => ({\n  \"background-color\": a0\n});\nfunction MapComponent_li_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 5);\n    i0.ɵɵlistener(\"click\", function MapComponent_li_6_Template_li_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const marcador_r2 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.irMarcador(marcador_r2.marker));\n    })(\"dblclick\", function MapComponent_li_6_Template_li_dblclick_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const i_r3 = restoredCtx.index;\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.borrarMarcador(i_r3));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const marcador_r2 = ctx.$implicit;\n    const i_r3 = ctx.index;\n    i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction1(2, _c1, marcador_r2.color));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Catrastrofe \", i_r3 + 1, \" \");\n  }\n}\nexport let MapComponent = /*#__PURE__*/(() => {\n  class MapComponent {\n    constructor() {\n      this.zoomLevel = 16;\n      // center: [number, number] = [ -102.76457, 20.81449 ];\n      this.center = [-102.78239, 20.847367];\n      // Arreglo de marcadores\n      this.marcadores = [];\n    }\n    ngAfterViewInit() {\n      this.mapa = new mapboxgl.Map({\n        container: this.divMapa.nativeElement,\n        style: 'mapbox://styles/mapbox/streets-v11',\n        center: this.center,\n        zoom: this.zoomLevel\n      });\n      this.leerLocalStorage();\n      // const markerHtml: HTMLElement = document.createElement('div');\n      // markerHtml.innerHTML = 'Hola Mundo';\n      // new mapboxgl.Marker()\n      //   .setLngLat( this.center )\n      //   .addTo( this.mapa );\n    }\n\n    agregarMarcador() {\n      // const color = \"#xxxxxx\".replace(/x/g, y=>(Math.random()*16|0).toString(16));\n      const color = \"#FF0000\";\n      const nuevoMarcador = new mapboxgl.Marker({\n        draggable: true,\n        color\n      }).setLngLat(this.center).addTo(this.mapa);\n      this.marcadores.push({\n        color,\n        marker: nuevoMarcador\n      });\n      this.guardarMarcadoresLocalStorage();\n      nuevoMarcador.on('dragend', () => {\n        this.guardarMarcadoresLocalStorage();\n      });\n    }\n    irMarcador(marker) {\n      this.mapa.flyTo({\n        center: marker.getLngLat()\n      });\n    }\n    guardarMarcadoresLocalStorage() {\n      const lngLatArr = [];\n      this.marcadores.forEach(m => {\n        const color = m.color;\n        const {\n          lng,\n          lat\n        } = m.marker.getLngLat();\n        lngLatArr.push({\n          color: color,\n          centro: [lng, lat]\n        });\n      });\n      localStorage.setItem('marcadores', JSON.stringify(lngLatArr));\n    }\n    leerLocalStorage() {\n      if (!localStorage.getItem('marcadores')) {\n        return;\n      }\n      const lngLatArr = JSON.parse(localStorage.getItem('marcadores'));\n      lngLatArr.forEach(m => {\n        const newMarker = new mapboxgl.Marker({\n          color: m.color,\n          draggable: true\n        }).setLngLat(m.centro).addTo(this.mapa);\n        this.marcadores.push({\n          marker: newMarker,\n          color: m.color\n        });\n        newMarker.on('dragend', () => {\n          this.guardarMarcadoresLocalStorage();\n        });\n      });\n    }\n    borrarMarcador(i) {\n      this.marcadores[i].marker?.remove();\n      this.marcadores.splice(i, 1);\n      this.guardarMarcadoresLocalStorage();\n    }\n    static #_ = this.ɵfac = function MapComponent_Factory(t) {\n      return new (t || MapComponent)();\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: MapComponent,\n      selectors: [[\"app-map\"]],\n      viewQuery: function MapComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(_c0, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.divMapa = _t.first);\n        }\n      },\n      decls: 7,\n      vars: 1,\n      consts: [[1, \"mapa-container\"], [\"mapa\", \"\"], [1, \"list-group\"], [1, \"list-group-item\", \"list-group-item-info\", 3, \"click\"], [\"class\", \"list-group-item\", 3, \"ngStyle\", \"click\", \"dblclick\", 4, \"ngFor\", \"ngForOf\"], [1, \"list-group-item\", 3, \"ngStyle\", \"click\", \"dblclick\"]],\n      template: function MapComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelement(0, \"app-menu\")(1, \"div\", 0, 1);\n          i0.ɵɵelementStart(3, \"ul\", 2)(4, \"li\", 3);\n          i0.ɵɵlistener(\"click\", function MapComponent_Template_li_click_4_listener() {\n            return ctx.agregarMarcador();\n          });\n          i0.ɵɵtext(5, \" + Agregar \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(6, MapComponent_li_6_Template, 2, 4, \"li\", 4);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"ngForOf\", ctx.marcadores);\n        }\n      },\n      dependencies: [i1.NgForOf, i1.NgStyle, i2.MenuComponent],\n      styles: [\".mapa-container[_ngcontent-%COMP%]{height:100%;width:100%}.list-group[_ngcontent-%COMP%]{position:fixed;top:100px;right:20px;z-index:99}li[_ngcontent-%COMP%]{cursor:pointer}@media screen and (max-width: 991px){.list-group[_ngcontent-%COMP%]{position:fixed;top:300px;right:20px;z-index:99}}\"]\n    });\n  }\n  return MapComponent;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MapComponent, [{\n    type: Component,\n    args: [{\n      selector: 'app-map',\n      template: \"<app-menu></app-menu>\\n<div #mapa class=\\\"mapa-container\\\"></div>\\n<ul class=\\\"list-group\\\">\\n    <li class=\\\"list-group-item list-group-item-info\\\"\\n        (click)=\\\"agregarMarcador()\\\">\\n        + Agregar\\n    </li>\\n    <li class=\\\"list-group-item\\\"\\n        *ngFor=\\\"let marcador of marcadores; let i = index\\\"\\n        (click)=\\\"irMarcador( marcador.marker! );\\\"\\n        (dblclick)=\\\"borrarMarcador( i )\\\"\\n        [ngStyle]=\\\"{\\n            'background-color': marcador.color\\n        }\\\">\\n        Catrastrofe {{ i + 1 }}\\n    </li>\\n</ul>\\n\",\n      styles: [\".mapa-container{height:100%;width:100%}.list-group{position:fixed;top:100px;right:20px;z-index:99}li{cursor:pointer}@media screen and (max-width: 991px){.list-group{position:fixed;top:300px;right:20px;z-index:99}}\\n\"]\n    }]\n  }], () => [], {\n    divMapa: [{\n      type: ViewChild,\n      args: ['mapa']\n    }]\n  });\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassDebugInfo(MapComponent, {\n    className: \"MapComponent\"\n  });\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}